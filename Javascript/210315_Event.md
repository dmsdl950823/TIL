
- [이벤트](#이벤트)
  - [이벤트 흐름 (Event Propagation)](#이벤트-흐름-event-propagation)
    - [* Event Bubbling](#-event-bubbling)
    - [* Event Capturing](#-event-capturing)
  - [DOM 이벤트 흐름](#dom-이벤트-흐름)
- [Event Handler](#event-handler)
  - [HTML Event Handler](#html-event-handler)
  - [Event handler - DOM lv.0](#event-handler---dom-lv0)
- [`event` 객체](#event-객체)
- [Event 타입](#event-타입)
  - [UI Event](#ui-event)
  - [Focus Event](#focus-event)
  - [Mouse Event & Mouse Wheel Event](#mouse-event--mouse-wheel-event)

# 이벤트

JS와 HTML 의 상호 작용은 **브라우저 창에서 발생한 '이벤트'에 의해 처리**됩니다. 이벤트는 이벤트가 일어날 때만 실행되는 '`listener(handler)`' 로 추적합니다.
이 모델을 **observer 패턴** 이라고 부릅니다. 이 패턴은 JS 에서 정의하는 행동과 HTML/CSS로 정의한 페이지 사이에 **느슨한 연결**을 형성합니다.

브라우저 이벤트 시스템은 상당히 복잡하므로 반드시 핵심 개념을 이해하고 있어야 합니다.

## 이벤트 흐름 (Event Propagation)

'이벤트 흐름'은 페이지에서 이벤트가 전달되는 순서를 말합니다. IE 에서는 **이벤트 버블링**(event bubbling)을, 넷스케이프 커뮤니케이터는 **이벤트 캡쳐링**(event capturing)을 지원했습니다.

### * Event Bubbling
이벤트 버블링은 **가장 깊이 위치한 요소에서 시작해 거슬러 올라가는 형식**입니다.
최신 브라우저는 모두 이벤트 버블링을 지원하지만 상세한 구현 방법에는 조금 차이가 있습니다. 이벤트는 window 객체 까지 거슬러 올라갑니다.

### * Event Capturing
이벤트 캡쳐링은 **최상위 노드에서 처음으로 이벤트가 발생하여, 타겟 노드에서 마지막으로 발생.**합니다. 이벤트가 의도한 요소에 도달하기 전에 잡아내려는 목적으로 디자인되었습니다. 이벤트는 window에서 시작됩니다.
  
  ** *오래된 브라우저에서는 이벤트 캡쳐링을 지원하지않으므로, `addEventListner()` 같은 메서드에서도 사용할지 말지를 옵션으로 받습니다. 이벤트 버블링을 주로 사용하고 이벤트 캡쳐링은 특별한 상황에서만 쓰길 권장합니다.*

## DOM 이벤트 흐름

<img src="https://ehsankorhani.com/assets/images/js-event-capture-bubble.png" width=500>

1. **이벤트 캡처링**
    > * 필요하다면 이 단계에서 이벤트를 잡아냅니다.
    > * 실제 타겟은 이벤트를 전달받지 않습니다.

2. **타겟 도달** 
    > * 타겟이 이벤트를 받음
    > * 이벤트 처리(handling)에서는 버블링 단계에 속하는 것으로 간주합니다.

3. **이벤트 버블링**
    > * 이벤트에 반응할 수 있는 마지막 기회
    > * 최상단 요소까지 거슬러 올라갑니다.
    
결과적으로 타겟에서 이벤트를 작업할 기회가 두번(bubble, capture) 생깁니다.

# Event Handler

이벤트는 사용자 / 브라우저가 취하는 특정 동작입니다. 이벤트에 응답하여 호출되는 함수를 `event handler`, `event listener` 라고 부릅니다. `event handler`의 이름은 `on` 으로 시작합니다. <sub>ex) `onclick`</sub>

## HTML Event Handler

각 요소가 지원하는 이벤트는 event handler 이름을 HTML 속성에 사용하여 할당할 수 있습니다. 
*&, , < > 같은 특수 문자를 이스케이프 없이 쓸 수 는 없습니다.*

``` html
  <script>
    function showMsg () {
      alert('Hello World!')
    }
  </script>

  <input type="button" value="Click Me!" onclick="alert('Clicked!')" />
  <input type="button" value="Click Me!" onclick="showMsg()" />
  <input type="button" value="Click Me!" onclick="console.log(event.type)" /> <!-- click -->
  <input type="button" value="Click Me!" onclick="console.log(this.value)" /> <!-- Click Me! --> 
  <input type="button" value="Click Me!" onclick="console.log(value)" /> <!-- Click Me! --> 
```

HTML 에 event handler를 할당하는 방법에는 몇 가지 단점이 있습니다.

1. 타이밍 문제 - handler 코드보다 사용자가 먼저 해당 요소를 조작하는 경우 에러가 발생합니다.
   > `try`, `catch` 문을 활용하여 에러를 처리합니다.
   > ``` html
   >   <input
   >    type="button"
   >    value="Click Me!"
   >    onclick="try { showMsg() } catch(ex) { console.error(ex) }"
   >    />
   > ```
2. 스코프 체인 확장 결과가 브라우저마다 다릅니다.
   > 식별자 해석에 사용하는 규칙이 JS 엔진에 따라 미묘하게 다르므로 에러가 발생할 수 있습니다. 
3. inline으로 event handler를 할당할 경우, 변경시에 HTML, JS 모두 바꿔야합니다.

## Event handler - DOM lv.0

JS 에서 event handler 를 할당하는 전통적인 방법은 event handler 프로퍼티에 함수를 할당하는 방법 입니다.
JS 에서 event handler 를 할당하려면 우선 객체에 대한 참조를 얻어야 합니다.

window / document 를 포함해 모든 element 에는 event handler 프로퍼티가 있으며, `onclick` 처럼 소문자입니다.

``` js
  const btn = document.getElementId('btn')
  btn.onclick = function () {
    console.log('Clicked')
    console.log(this.id) // btn
  }
  btn.onclick = null
```

이 코드를 실행하기 전에는 event handler가 할당되지 않으므로, 이 코드가 버튼 markup 보다 뒤에있다면 버튼을 클릭해도 반응이 없는 시간이 존재할 수 있습니다.
event handler 는 element 의 스코프에서 실행되며, `this` 는 해당 요소를 가리킵니다.

event handler 내부에서는 `this` 를 통해 element의 프로퍼티나 메서드에 접근 가능합니다.
이런 방식으로 추가한 이벤트 핸들러는 이벤트 흐름에서 버블링 단계에 실행되도록 의도한 것 입니다.

DOM lv.0 접근법으로 할당한 event handler 를 제거할 때는 해당 event handler 프로퍼티를 `null` 로 설정합니다.

# `event` 객체

DOM 이벤트 발생하면 관련 정보는 모두 `event` 객체 저장됩니다. event hanlder 를 할당할 때 `event` 객체가 전달됩니다. 

``` js
  const btn = document.getElementId('btn')
  btn.onclick = function (event) {
    console.log(event)
  }

  btn.addEventListner('click', function (event) {
    console.log(event.type)
  }, false)
```

HTML 내부 inline 으로 event handler를 할당했을 때는 `event` 변수가 event 객체 구실을 합니다.  

``` js
  <input type="button" value="Click me!" onclick="alert(event.type)">
```

`event` 객체에는 이벤트와 관련된 프로퍼티/메서드가 [포함](https://developer.mozilla.org/en-US/docs/Web/API/Event)됩니다. 


# Event 타입

웹 브라우저에서 발생하는 event는 정말 많습니다. event 타입에 따라 이벤트 관련 정보가 다릅니다. 
```
  - User Interface (UI) Event :: 일반적인 브라우저 이벤트이며 BOM 과의 상호 작용이 포함
  - Focus Event :: 요소가 focus 를 얻거나 잃을때 발생 
  - Mouse Event :: 마우스로 어떤 동작을 취할 때 발생
  - Wheel Event :: 마우스 휠 등의 장치를 사용할때 발생
  - Text Event :: 문서에 텍스트를 입력할 때 발생
  - Keyboard Event :: 키보드로 어떤 동작을 취할때 발생합니다.
  - Composition Event :: 구성 이벤트는 입력 방법 에디터(IME : Input Method Editor) 를 통해 문자를 입력할 때 발생합니다.
  - Mutation Event :: 변경 이벤트는 DOM 구조가 바뀔 때 발생합니다. 
```

## UI Event

UI 이벤트는 사용자와 직접 관련이 있지는 않습니다. 이 이벤트는 DOM 명세 이전에 존재했으며, 하위 호환성 때문에 남겨졌습니다.

| Event         | 설명                                                                                                                 |
| ------------- | -------------------------------------------------------------------------------------------------------------------- |
| `DOMActivate` | - 사용자가 마우스/키보드로 요소를 활성화 했을때 발생                                                                 |
|               | - *사용하지 않기를 권함*                                                                                             |
| `load`        | - 페이지를 완전히 불러왔을 때 `window` 에서 발생                                                                     |
|               | - 모든 `frame` 을 완전히 불러왔을때 `frameset` 에서 발생                                                             |
|               | - 이미지/객체 를 완전히 불러왔을 때 `<img>`, `<object>` 요소에서 발생                                                |
| `unload`      | - 페이지를 완전히 종료했을 때 / 다른 페이지로 이동할 때  `window` 에서 발생                                          |
|               | - 모든 `frame` 을 완전히 종료했을 때 `frameset` 에서 발생                                                            |
|               | - 객체를 완전히 종료했을 때 `<object>` 요소에서 발생                                                                 |
|               | - 각종 **참조를 제거하여 메모리 누수를 방지하는 목적**으로 사용                                                      |
| `abort`       | - `<object>` 요소의 콘텐츠를 완전히 내려받기 전, 사용자가 취소했을 때 해당 요소에서 발생                             |
| `error`       | - JS error가 발생했을 때 window 에서 발생                                                                            |
|               | - 이미지를 불러올 수 없을 때 `<img>` 요소에서 발생                                                                   |
|               | - `<object>` 요소 콘텐츠를 불러올 수 없을 때 요소에서 발생                                                           |
|               | - `frame` 을 불러올 수 없을 때 `frameset` 에서 발생                                                                  |
| `select`      | - 사용자가 `<input>`, `<textarea>` 에서 글자를 선택할 때 발생                                                        |
| `resize`      | `window` 나 `frame` 의 크기를 바꿀 때 발생 (각 브라우저마다 구현방식이 다르므로 성능 이슈 존재)                      |
| `scroll`      | 사용자가 scrollbar 있는 요소를 scroll 할 때 발생합니다. `<body>` 요소에는 페이지 전체에 대한 scroll bar 가 있습니다. |

``` js
  // load event
  window.addEventListener('load', () => console.log('hello world!'))

  const image = new Image()
  image.src = 'sampleUrl...'
  image.addEventListener('load', e => console.log(e.target)) // <img src="sampleUrl" />

  // unload event
  window.addEventListener('unload', () => console.log('bye world!'))

  // resize event
  window.addEventListener('resize', () => console.log('resizing...'))
```

## Focus Event

| Event         | 설명                                                           |
| ------------- | -------------------------------------------------------------- |
| `blur`        | 요소가 focus 를 잃을 때 발생 (버블링 X)                        |
| `DOMFocusIn`  | 요소가 focus 를 받을 때 발생 (HTML 이벤트의 focus 버블링 버전) |
| `DOMFocusOut` | 요소가 focus 를 잃을 때 발생 (HTML 이벤트의 blur 버블링 버전)  |
| `focus`       | 요소가 focus 를 받을 때 발생 (버블링 X)                        |
| `focusin`     | 요소가 focus 를 받을 때 발생 (버블링 O)                        |
| `focusout`    | 요소가 focus 를 잃을 때 발생 (버블링 O)                        |

1. focus 를 잃는 요소에서 `focusout` 발생
2. focus 를 받는 요소에서 `focusin` 발생
3. focus 를 잃는 요소에서 `blur` 발생
4. focus 를 잃는 요소에서 `DOMFocusOut` 발생
5. focus 를 받는 요소에서 `focus` 발생
6. focus 를 받는 요소에서 `DOMFocusIn` 발생

## Mouse Event & Mouse Wheel Event


| Event        | 설명                                                                                                                      |
| ------------ | ------------------------------------------------------------------------------------------------------------------------- |
| `click`      | 마우스 버튼 click / 키보드 enter key 를 누를 때 발생 (**마우스, 키보드에 모두 반응한다는 점은 접근성 구현에 중요합니다**) |
| `dbclick`    | 사용자가 주요 마우스 버튼을 더블클릭할 때 발생                                                                            |
| `mousedown`  | 마우스 버튼을 **누를 때** 발생 (키보드에서 발생 X)                                                                        |
| `mouseenter` | 마우스 커서가 밖에서 요소 안으로 이동할 때 발생 (버블링 X)                                                                |
| `mouseleave` | 마우스 커서가 요소 위에 있다가 요소 밖으로 이동할 때 발생 (버블링 X)                                                      |
| `mousemove`  | 마우스 커서가 요소 주변을 이동하는 동안 발생 (키보드에서 발생 X)                                                          |
| `mouseout`   | 마우스 커서가 요소 위에 있다가 다른 요소위로 이동할 때 발생                                                               |
| `mouseover`  | 마우스 커서가 요소 바깥에 있다가 요소 안으로 이동할때 발생                                                                |
| `mouseup`    | 사용자가 마우스 버튼을 누르고 있다가 놓을 때 발생 (키보드에서 발생 X)                                                     |

모든 요소가 마우스 이벤트를 지원합니다.
`mouseenter`와 `mouseleave` 를 제외하면 모든 마우스 이벤트가 **버블링되어 올라가며**, 모든 마우스 이벤트는 **취소할 수 있고** 이는 브라우저의 기본 동작에 영향을 미칩니다.

마우스 이벤트는 항상 다음 순서대로 발생합니다.

1. `mousedown`
2. `mouseup`
3. `click`
4. `mousedown`
5. `mouseup`
6. `click`
7. `dbclick`

**wheel event** 
